\documentclass[12pt]{article}

\usepackage[utf8]{inputenc}
\usepackage[russian]{babel}
\usepackage{graphicx}
\usepackage{listings}
\usepackage{color}
\usepackage{cite}
\usepackage{titlesec}
\usepackage{svg}
\usepackage{geometry}
\usepackage{indentfirst}
\usepackage{float}

\title{Диплом}
\begin{document}

\maketitle
\pagebreak
\section{Введение}


Одним из продуктов компании "Институт Сетевых Технологий" является МД (маршутизатор доступа). В качестве операционной системы он использует не всем привычный linux, а eCos. Причём eCos не является операционной системой в обычном понимании этого термина. Она похожа на библиотеку, так как линкуется с пользовательским кодом и загружается с помощью специального загрузчика RedBoot.

В МД реализовано множество сервисов, хорошо знакомым администраторам linux например (HTTP сервер, SSH сервер), однако DHCP сервер в МД не реализован (хотя есть DHCP ретранслятор).

Так как протокол DHCP используется повсеместно, в МД тоже понадобилось его реализовать.

% Постановка задачи

% Анализ существующих решений, и Обоснование выбора

% Реализация

\pagebreak
\section{Основная часть}

\subsection{Описание прикладного процесса}
Компонент будет автоматизировать настройку узлов компьютерных сетей.

Сам процесс выглядит следующим образом:
администратор подходит к компьютеру, открывает программу эмуляции терминала и вручную его настраивает (задаёт IP адрес, прописывает маршруты, возможно что-то ещё). Далее он подходит к следующему компьютеру и тоже его настраивает.

Для автоматизации данного процесса необходимо через web интерфейс или терминал настроить DHCP сервер (описать различные профили настроек и правила их присваивания). Также необходимо настроить присваивание IP адресов по DHCP на клиентах (обычно это по умолчанию и так).

Если DHCP сервер не находится в той же локальной сети, в ней необходимо будет настроить DHCP ретранслятор.

\subsection{Постановка задачи}

\begin{itemize}
    \item Изучение RFC2131, RFC2132 и других RFC описывающих стандарт DHCP и различных опциональных параметров
    \item Изучение документации на уже существующие DHCP сервера (cisco, isc)
    \item Придумать, как сервер будет конфигурироваться
    \item Проектирование програмной архитектуры и архитектуры данных
    \item Разработка DHCP сервера
    \item Написание документации
\end{itemize}

\subsection{Анализ существующих решений, обоснование выбора.}

Существует множество DHCP серверов с открытым исходным кодом, написанных под linux.
Однако ни один из них не получится использовать, так как в МД в качестве операционной системы используется eCos.

Данная ситуация оставляет только два пути

\begin{enumerate}
    \item Взять один из DHCP серверов с открытым исходным кодом и портировать.
    \item Написать DHCP сервер с нуля.
\end{enumerate}

При портировании придётся потратить много времени на чтение кода.
Также при изменении функциональных требований будет сложнее модифицировать код.

Модель многозадачности в МД не такая как в линуксе.
В линуксе ядро может прервать процесс, в МД процесс должен сам завершится.
Данный факт также усложнит портирование.

В добавок к этому запрещено использовать исключения, а поэтому и STL.

При наисании с нуля будет полное понимание написанного кода, что позволит быстрее реагировать на измениние функциональных требований.

В связи с выше сказанным был сделан выбор в пользу написания DHCP сервера с нуля.

\subsection{Функциональные требования}

В протоколе DHCP помимо IP адресов отправлять множество других параметров.
Эти параметры необходимо разбить на несколько логически связанных групп.
Например, TCP параметры. В эту группу должны будут входить 3 параметра.

\begin{itemize}
    \item Значение TTL, используемое при отправке TCP пакетов по умолчанию.
    \item TCP keepalive интервал (сколько ждать перед отправкой keepalive сообщения).
    \item TCP keepalive garbage - отправлять ли специальный октет, для совместимости со старыми реализациями TCP.
\end{itemize}

На такие группы необходимо поделить DHCP параметры.

Администратор, настраивающий DHCP сервер должен иметь возможность создавать экземпляры таких групп, и присваивать им имена, для того чтобы на них затем ссылаться (возможно из нескольких мест одновременно).

\begin{figure}[H]
    \includegraphics[width=\textwidth]{build/first.png}
    \caption{}
\end{figure}

\begin{itemize}
    \item Выбор подсети по адресу ретранслятора
    \item Разделение выдаваемых адресов в подсети по следующему принципу
        \subitem В подсети задается список интервалов IP адресов.
        \subitem У каждого интервала также указывается каждая группа параметров.
        \subitem К каждому интервалу добавляется правила на основе полей пакета.
        \subitem Если правила подошли, адрес и параметры выдаются из этого элемента.
        \subitem Если нет, проверяется следующий элемент.
    \item Помимо описанного выше выделения групп с общими параметрами также нужно, чтобы была возможность присваивать параметры к одному конкретному хосту (например выбирая по mac адресу).
\end{itemize}

\subsection{Архитектура}

\begin{figure}[H]
    \includegraphics[width=\textwidth]{build/second.png}
    \caption{}
\end{figure}

\begin{figure}[H]
    \includegraphics[width=\textwidth]{build/packet-view.png}
    \caption{}
\end{figure}

Тут класс Options\_view написан на шаблонах и гарантирует на этапе компиляции правильность работы с DHCP опциями.

Класс All\_options\_view следит за тем, используются ли поля sname и file в заголовке для хранения опций, и, предоставляя такой же, как и класс Options\_view интерфейс, абстрагирует данную логику.

\begin{figure}[H]
    \includegraphics[width=\textwidth]{build/pinger.png}
    \caption{}
\end{figure}

\pagebreak
\subsection{Тестирование}

Для тестирования были написаны Unit-тесты, с помощью библиотеки googletest.
Помимо них был написан python скрипт для эмуляции DHCP клиентов.

В нём использовался линуксовый механизм сетевых пространств имён.

Были созданы пространства имён, соединены с помощью виртуальных сетевых интерфейсов (veth pair). В каждом из них был запущен либо DHCP клиент от ISC либо DHCP ретранслятор тоже от ISC.

Это дало возможность тестировать на одном компьютере, в близких к реальным условиям.

\includegraphics[width=\textwidth]{build/test-emu.png}

\pagebreak
\section{Заключение}

\end{document}
